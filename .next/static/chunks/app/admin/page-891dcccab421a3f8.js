(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{25:(e,s,a)=>{Promise.resolve().then(a.bind(a,6235))},6235:(e,s,a)=>{"use strict";a.d(s,{default:()=>t});var l=a(5155),r=a(2115);function t(){let[e,s]=(0,r.useState)([]),[a,t]=(0,r.useState)(""),[d,n]=(0,r.useState)(""),[i,o]=(0,r.useState)(""),[c,u]=(0,r.useState)(!0),[p,m]=(0,r.useState)(""),[h,x]=(0,r.useState)(null),[b,j]=(0,r.useState)(null),[y,f]=(0,r.useState)({username:"",displayName:"",password:"",role:"user",disabled:!1}),N=(0,r.useCallback)(async()=>{let e=new URLSearchParams;a&&e.set("search",a),d&&e.set("role",d),i&&e.set("disabled",i);let l=await fetch("/api/admin/users?"+e);if(!l.ok){m("Failed to load users");return}s(await l.json())},[a,d,i]);async function g(e){e.preventDefault(),m("");let s=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:y.username,displayName:y.displayName,password:y.password,role:y.role})}),a=await s.json().catch(()=>({}));if(!s.ok){m(a.error||"Failed to create user");return}x(null),f({username:"",displayName:"",password:"",role:"user",disabled:!1}),N()}async function w(e){if(e.preventDefault(),!b)return;m("");let s=await fetch("/api/admin/users/"+b.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:y.displayName,role:y.role,disabled:y.disabled})}),a=await s.json().catch(()=>({}));if(!s.ok){m(a.error||"Failed to update");return}x(null),j(null),N()}async function v(){if(!b)return;let e=y.password||"TempPass123!",s=await fetch("/api/admin/users/"+b.id+"/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newPassword:e})}),a=await s.json().catch(()=>({}));if(!s.ok){m(a.error||"Failed to reset password");return}x(null),j(null),f({...y,password:""})}async function C(e){if(!confirm("Delete user "+e.username+"?"))return;let s=await fetch("/api/admin/users/"+e.id,{method:"DELETE"}),a=await s.json().catch(()=>({}));if(!s.ok){m(a.error||"Failed to delete");return}N()}return(0,r.useEffect)(()=>{u(!0),N().finally(()=>u(!1))},[N]),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex flex-wrap gap-4 mb-4",children:[(0,l.jsx)("input",{type:"text",placeholder:"Search username",value:a,onChange:e=>t(e.target.value),className:"border rounded px-2 py-1"}),(0,l.jsxs)("select",{value:d,onChange:e=>n(e.target.value),className:"border rounded px-2 py-1",children:[(0,l.jsx)("option",{value:"",children:"All roles"}),(0,l.jsx)("option",{value:"admin",children:"Admin"}),(0,l.jsx)("option",{value:"user",children:"User"})]}),(0,l.jsxs)("select",{value:i,onChange:e=>o(e.target.value),className:"border rounded px-2 py-1",children:[(0,l.jsx)("option",{value:"",children:"All"}),(0,l.jsx)("option",{value:"true",children:"Disabled"}),(0,l.jsx)("option",{value:"false",children:"Enabled"})]}),(0,l.jsx)("button",{type:"button",onClick:()=>{x("create"),f({username:"",displayName:"",password:"",role:"user",disabled:!1})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Create user"})]}),p&&(0,l.jsx)("p",{className:"text-red-600 text-sm mb-2",children:p}),c?(0,l.jsx)("p",{children:"Loadingâ€¦"}):(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full border-collapse border",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-gray-100",children:[(0,l.jsx)("th",{className:"border p-2 text-left",children:"Username"}),(0,l.jsx)("th",{className:"border p-2 text-left",children:"Display name"}),(0,l.jsx)("th",{className:"border p-2 text-left",children:"Role"}),(0,l.jsx)("th",{className:"border p-2 text-left",children:"Status"}),(0,l.jsx)("th",{className:"border p-2 text-left",children:"Actions"})]})}),(0,l.jsx)("tbody",{children:e.map(e=>(0,l.jsxs)("tr",{className:"border",children:[(0,l.jsx)("td",{className:"border p-2",children:e.username}),(0,l.jsx)("td",{className:"border p-2",children:e.displayName}),(0,l.jsx)("td",{className:"border p-2",children:e.role}),(0,l.jsxs)("td",{className:"border p-2",children:[e.disabled?(0,l.jsx)("span",{className:"text-red-600",children:"Disabled"}):(0,l.jsx)("span",{className:"text-green-600",children:"Enabled"}),e.mustChangePassword&&" (must change PW)"]}),(0,l.jsxs)("td",{className:"border p-2 flex gap-2 flex-wrap",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{j(e),f({username:e.username,displayName:e.displayName,password:"",role:e.role,disabled:e.disabled}),x("edit")},className:"text-blue-600 hover:underline text-sm",children:"Edit"}),(0,l.jsx)("button",{type:"button",onClick:()=>{j(e),f({...y,password:"TempPass123!"}),x("reset")},className:"text-amber-600 hover:underline text-sm",children:"Reset password"}),(0,l.jsx)("button",{type:"button",onClick:()=>C(e),className:"text-red-600 hover:underline text-sm",children:"Delete"})]})]},e.id))})]})}),"create"===h&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[(0,l.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Create user"}),(0,l.jsxs)("form",{onSubmit:g,className:"space-y-3",children:[(0,l.jsx)("input",{type:"text",placeholder:"Username",value:y.username,onChange:e=>f({...y,username:e.target.value}),className:"w-full border rounded px-2 py-1",required:!0}),(0,l.jsx)("input",{type:"text",placeholder:"Display name",value:y.displayName,onChange:e=>f({...y,displayName:e.target.value}),className:"w-full border rounded px-2 py-1",required:!0}),(0,l.jsx)("input",{type:"password",placeholder:"Temporary password",value:y.password,onChange:e=>f({...y,password:e.target.value}),className:"w-full border rounded px-2 py-1",required:!0,minLength:8}),(0,l.jsxs)("select",{value:y.role,onChange:e=>f({...y,role:e.target.value}),className:"w-full border rounded px-2 py-1",children:[(0,l.jsx)("option",{value:"user",children:"User"}),(0,l.jsx)("option",{value:"admin",children:"Admin"})]}),(0,l.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,l.jsx)("button",{type:"button",onClick:()=>x(null),className:"px-4 py-2 border rounded",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Create"})]})]})]})}),"edit"===h&&b&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[(0,l.jsxs)("h2",{className:"text-lg font-bold mb-4",children:["Edit ",b.username]}),(0,l.jsxs)("form",{onSubmit:w,className:"space-y-3",children:[(0,l.jsx)("input",{type:"text",placeholder:"Display name",value:y.displayName,onChange:e=>f({...y,displayName:e.target.value}),className:"w-full border rounded px-2 py-1",required:!0}),(0,l.jsxs)("select",{value:y.role,onChange:e=>f({...y,role:e.target.value}),className:"w-full border rounded px-2 py-1",children:[(0,l.jsx)("option",{value:"user",children:"User"}),(0,l.jsx)("option",{value:"admin",children:"Admin"})]}),(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:y.disabled,onChange:e=>f({...y,disabled:e.target.checked})}),"Disabled (pause login)"]}),(0,l.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,l.jsx)("button",{type:"button",onClick:()=>x(null),className:"px-4 py-2 border rounded",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save"})]})]})]})}),"reset"===h&&b&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[(0,l.jsxs)("h2",{className:"text-lg font-bold mb-4",children:["Reset password for ",b.username]}),(0,l.jsx)("input",{type:"text",placeholder:"New temporary password",value:y.password,onChange:e=>f({...y,password:e.target.value}),className:"w-full border rounded px-2 py-1 mb-4",minLength:8}),(0,l.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,l.jsx)("button",{type:"button",onClick:()=>x(null),className:"px-4 py-2 border rounded",children:"Cancel"}),(0,l.jsx)("button",{type:"button",onClick:v,className:"px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700",children:"Reset password"})]})]})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[441,517,358],()=>s(25)),_N_E=e.O()}]);