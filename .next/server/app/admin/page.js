(()=>{var e={};e.id=698,e.ids=[698],e.modules={6330:e=>{"use strict";e.exports=require("@prisma/client")},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5511:e=>{"use strict";e.exports=require("crypto")},3873:e=>{"use strict";e.exports=require("path")},7598:e=>{"use strict";e.exports=require("node:crypto")},5712:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>n.a,__next_app__:()=>p,pages:()=>u,routeModule:()=>c,tree:()=>i});var r=a(260),t=a(8203),l=a(5155),n=a.n(l),d=a(7292),o={};for(let e in d)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>d[e]);a.d(s,o);let i=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,7949)),"C:\\Users\\mlodg\\Downloads\\HUD\\hud-webapp\\src\\app\\admin\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,6038)),"C:\\Users\\mlodg\\Downloads\\HUD\\hud-webapp\\src\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,1354)),"C:\\Users\\mlodg\\Downloads\\HUD\\hud-webapp\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9937,23)),"next/dist/client/components/not-found-error"]}],u=["C:\\Users\\mlodg\\Downloads\\HUD\\hud-webapp\\src\\app\\admin\\page.tsx"],p={require:a,loadChunk:()=>Promise.resolve()},c=new r.AppPageRouteModule({definition:{kind:t.RouteKind.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:i}})},2087:(e,s,a)=>{Promise.resolve().then(a.bind(a,4955))},8879:(e,s,a)=>{Promise.resolve().then(a.bind(a,7559))},7559:(e,s,a)=>{"use strict";a.d(s,{default:()=>l});var r=a(5512),t=a(8009);function l(){let[e,s]=(0,t.useState)([]),[a,l]=(0,t.useState)(""),[n,d]=(0,t.useState)(""),[o,i]=(0,t.useState)(""),[u,p]=(0,t.useState)(!0),[c,m]=(0,t.useState)(""),[x,h]=(0,t.useState)(null),[b,f]=(0,t.useState)(null),[j,y]=(0,t.useState)({username:"",displayName:"",password:"",role:"user",disabled:!1}),g=(0,t.useCallback)(async()=>{let e=new URLSearchParams;a&&e.set("search",a),n&&e.set("role",n),o&&e.set("disabled",o);let r=await fetch("/api/admin/users?"+e);if(!r.ok){m("Failed to load users");return}s(await r.json())},[a,n,o]);async function w(e){e.preventDefault(),m("");let s=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:j.username,displayName:j.displayName,password:j.password,role:j.role})}),a=await s.json().catch(()=>({}));if(!s.ok){m(a.error||"Failed to create user");return}h(null),y({username:"",displayName:"",password:"",role:"user",disabled:!1}),g()}async function v(e){if(e.preventDefault(),!b)return;m("");let s=await fetch("/api/admin/users/"+b.id,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:j.displayName,role:j.role,disabled:j.disabled})}),a=await s.json().catch(()=>({}));if(!s.ok){m(a.error||"Failed to update");return}h(null),f(null),g()}async function N(){if(!b)return;let e=j.password||"TempPass123!",s=await fetch("/api/admin/users/"+b.id+"/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newPassword:e})}),a=await s.json().catch(()=>({}));if(!s.ok){m(a.error||"Failed to reset password");return}h(null),f(null),y({...j,password:""})}async function C(e){if(!confirm("Delete user "+e.username+"?"))return;let s=await fetch("/api/admin/users/"+e.id,{method:"DELETE"}),a=await s.json().catch(()=>({}));if(!s.ok){m(a.error||"Failed to delete");return}g()}return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 mb-4",children:[(0,r.jsx)("input",{type:"text",placeholder:"Search username",value:a,onChange:e=>l(e.target.value),className:"border rounded px-2 py-1"}),(0,r.jsxs)("select",{value:n,onChange:e=>d(e.target.value),className:"border rounded px-2 py-1",children:[(0,r.jsx)("option",{value:"",children:"All roles"}),(0,r.jsx)("option",{value:"admin",children:"Admin"}),(0,r.jsx)("option",{value:"user",children:"User"})]}),(0,r.jsxs)("select",{value:o,onChange:e=>i(e.target.value),className:"border rounded px-2 py-1",children:[(0,r.jsx)("option",{value:"",children:"All"}),(0,r.jsx)("option",{value:"true",children:"Disabled"}),(0,r.jsx)("option",{value:"false",children:"Enabled"})]}),(0,r.jsx)("button",{type:"button",onClick:()=>{h("create"),y({username:"",displayName:"",password:"",role:"user",disabled:!1})},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Create user"})]}),c&&(0,r.jsx)("p",{className:"text-red-600 text-sm mb-2",children:c}),u?(0,r.jsx)("p",{children:"Loadingâ€¦"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full border-collapse border",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-100",children:[(0,r.jsx)("th",{className:"border p-2 text-left",children:"Username"}),(0,r.jsx)("th",{className:"border p-2 text-left",children:"Display name"}),(0,r.jsx)("th",{className:"border p-2 text-left",children:"Role"}),(0,r.jsx)("th",{className:"border p-2 text-left",children:"Status"}),(0,r.jsx)("th",{className:"border p-2 text-left",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:e.map(e=>(0,r.jsxs)("tr",{className:"border",children:[(0,r.jsx)("td",{className:"border p-2",children:e.username}),(0,r.jsx)("td",{className:"border p-2",children:e.displayName}),(0,r.jsx)("td",{className:"border p-2",children:e.role}),(0,r.jsxs)("td",{className:"border p-2",children:[e.disabled?(0,r.jsx)("span",{className:"text-red-600",children:"Disabled"}):(0,r.jsx)("span",{className:"text-green-600",children:"Enabled"}),e.mustChangePassword&&" (must change PW)"]}),(0,r.jsxs)("td",{className:"border p-2 flex gap-2 flex-wrap",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{f(e),y({username:e.username,displayName:e.displayName,password:"",role:e.role,disabled:e.disabled}),h("edit")},className:"text-blue-600 hover:underline text-sm",children:"Edit"}),(0,r.jsx)("button",{type:"button",onClick:()=>{f(e),y({...j,password:"TempPass123!"}),h("reset")},className:"text-amber-600 hover:underline text-sm",children:"Reset password"}),(0,r.jsx)("button",{type:"button",onClick:()=>C(e),className:"text-red-600 hover:underline text-sm",children:"Delete"})]})]},e.id))})]})}),"create"===x&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Create user"}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-3",children:[(0,r.jsx)("input",{type:"text",placeholder:"Username",value:j.username,onChange:e=>y({...j,username:e.target.value}),className:"w-full border rounded px-2 py-1",required:!0}),(0,r.jsx)("input",{type:"text",placeholder:"Display name",value:j.displayName,onChange:e=>y({...j,displayName:e.target.value}),className:"w-full border rounded px-2 py-1",required:!0}),(0,r.jsx)("input",{type:"password",placeholder:"Temporary password",value:j.password,onChange:e=>y({...j,password:e.target.value}),className:"w-full border rounded px-2 py-1",required:!0,minLength:8}),(0,r.jsxs)("select",{value:j.role,onChange:e=>y({...j,role:e.target.value}),className:"w-full border rounded px-2 py-1",children:[(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{type:"button",onClick:()=>h(null),className:"px-4 py-2 border rounded",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Create"})]})]})]})}),"edit"===x&&b&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold mb-4",children:["Edit ",b.username]}),(0,r.jsxs)("form",{onSubmit:v,className:"space-y-3",children:[(0,r.jsx)("input",{type:"text",placeholder:"Display name",value:j.displayName,onChange:e=>y({...j,displayName:e.target.value}),className:"w-full border rounded px-2 py-1",required:!0}),(0,r.jsxs)("select",{value:j.role,onChange:e=>y({...j,role:e.target.value}),className:"w-full border rounded px-2 py-1",children:[(0,r.jsx)("option",{value:"user",children:"User"}),(0,r.jsx)("option",{value:"admin",children:"Admin"})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:j.disabled,onChange:e=>y({...j,disabled:e.target.checked})}),"Disabled (pause login)"]}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{type:"button",onClick:()=>h(null),className:"px-4 py-2 border rounded",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Save"})]})]})]})}),"reset"===x&&b&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold mb-4",children:["Reset password for ",b.username]}),(0,r.jsx)("input",{type:"text",placeholder:"New temporary password",value:j.password,onChange:e=>y({...j,password:e.target.value}),className:"w-full border rounded px-2 py-1 mb-4",minLength:8}),(0,r.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,r.jsx)("button",{type:"button",onClick:()=>h(null),className:"px-4 py-2 border rounded",children:"Cancel"}),(0,r.jsx)("button",{type:"button",onClick:N,className:"px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700",children:"Reset password"})]})]})})]})}},4955:(e,s,a)=>{"use strict";a.d(s,{default:()=>r});let r=(0,a(6760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\mlodg\\\\Downloads\\\\HUD\\\\hud-webapp\\\\src\\\\app\\\\admin\\\\AdminUsers.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\mlodg\\Downloads\\HUD\\hud-webapp\\src\\app\\admin\\AdminUsers.tsx","default")},7949:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>d});var r=a(2740),t=a(7702),l=a(1831),n=a(4955);async function d(){let e=await (0,t.Hx)();return e&&"admin"===e.role||(0,l.redirect)("/login"),(0,r.jsxs)("main",{className:"p-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"User management"}),(0,r.jsx)(n.default,{})]})}}};var s=require("../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),r=s.X(0,[989,44,112,801,101],()=>a(5712));module.exports=r})();